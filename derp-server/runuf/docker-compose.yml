services:
  derper:
    image: fredliang/derper:latest
    container_name: derper
    restart: unless-stopped
    ports:
      - "443:443"        # HTTPS 服务
      - "3478:3478/udp"  # STUN 服务
    environment:
      - DERP_DOMAIN=derp-aly.grep2000.com
      - DERP_CERT_MODE=manual
      - DERP_ADDR=:443
      - DERP_STUN=true
      - DERP_VERIFY_CLIENTS=false
      - DERP_HOSTNAME=derp-aly.grep2000.com
    volumes:
      - ../certs:/app/certs  # 持久化证书
    entrypoint: ["sh", "-c", "rm -rf /var/lib/derper && exec derper"]
    env_file:
      - ../.env                                          # ← 每台服务器只改这一个文件
